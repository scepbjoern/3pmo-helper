<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>3PMo Helper</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="vendor/xlsx.full.min.js"></script>
  <script defer src="script.js"></script>
</head>
<body>
  <div class="container">
    <h1>3PMo Helper</h1>

    <div class="tabs">
      <button id="tabSQ" class="tab active" type="button">StudentQuiz-Bewertung</button>
      <button id="tabAssign" class="tab" type="button">Studierenden-Themenzuteilung</button>
    </div>

    <section id="page-sq" class="page active" aria-labelledby="tabSQ">
      
      <!-- Bereich 1: Übersicht -->
      <details class="wizard-section" open>
        <summary><h2>1. Übersicht</h2></summary>
        <div class="wizard-content">
          <p class="hint">Willkommen beim StudentQuiz-Bewertungs-Wizard. Folgen Sie diesen Schritten:</p>
          <ol>
            <li><strong>StudentQuiz-Tabelle extrahieren:</strong> Kopieren Sie die HTML-Tabelle aus dem Reiter "StudentQuiz" der Moodle-Aktivität und extrahieren Sie die relevanten Fragendaten (questionname, creatorname, difficultylevel, rate, comments).</li>
            <li><strong>Rangliste-Tabelle extrahieren:</strong> Kopieren Sie die HTML-Tabelle aus dem Reiter "Rangliste" der Moodle-Aktivität und extrahieren Sie die Studierendenleistungen (student_name, published_question_points, rating_points, correct_answers_points, false_answers_points).</li>
            <li><strong>Bewertungen:</strong> Basierend auf den extrahierten Daten aus Bereich 1 und 2 wird automatisch eine Bewertung der Studierenden vorgenommen. Sie können die Bewertungen manuell anpassen und begründen.</li>
            <li><strong>Export:</strong> Laden Sie die finalen Bewertungen als Excel-Datei herunter.</li>
          </ol>
        </div>
      </details>

      <!-- Bereich 2: StudentQuiz-Tabelle extrahieren -->
      <details class="wizard-section" open>
        <summary><h2>2. StudentQuiz-Tabelle extrahieren</h2></summary>
        <div class="wizard-content">
          <p class="hint">Fügen Sie unten HTML mit der Tabelle aus dem Reiter "StudentQuiz" einer Moodle-Aktivität "StudentQuiz" ein. Extrahiert werden: <strong>questionname</strong>, <strong>creatorname</strong>, <strong>difficultylevel</strong>, <strong>rate</strong>, <strong>comments</strong>. Danach können Sie die Daten als Excel herunterladen.</p>

          <label for="htmlInput" class="label">HTML-Eingabe</label>
          <textarea id="htmlInput" placeholder="Hier HTML-Code einfügen..."></textarea>

          <div class="buttons">
            <button id="btnSample" type="button">Beispiel einfügen</button>
            <button id="btnParse" type="button" class="primary">Extrahieren & Vorschau</button>
            <button id="btnClear" type="button" class="secondary">Leeren</button>
            <button id="btnDownload" type="button" class="success">Als Excel herunterladen</button>
          </div>

          <div id="status" class="status" role="status" aria-live="polite"></div>

          <div class="table-wrapper">
            <table id="previewTable">
              <thead>
                <tr>
                  <th>questionname</th>
                  <th>creatorname</th>
                  <th>difficultylevel</th>
                  <th>rate</th>
                  <th>comments</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <details class="note">
            <summary>Hinweis zur Extraktion</summary>
            <ul>
              <li><strong>difficultylevel</strong> wird nur aus <code>data-difficultylevel</code> gelesen. Falls nicht vorhanden, bleibt das Feld leer.</li>
              <li><strong>rate</strong> wird nur aus <code>data-rate</code> gelesen. Falls nicht vorhanden, bleibt das Feld leer.</li>
              <li><strong>comments</strong>: "n.a." wird als 0 gezählt.</li>
            </ul>
          </details>
        </div>
      </details>

      <!-- Bereich 3: Rangliste-Tabelle extrahieren -->
      <details class="wizard-section" open>
        <summary><h2>3. Rangliste-Tabelle extrahieren</h2></summary>
        <div class="wizard-content">
          <p class="hint">Fügen Sie unten HTML mit der Tabelle aus dem Reiter "Rangliste" einer Moodle-Aktivität "StudentQuiz" ein. Extrahiert werden: <strong>student_name</strong>, <strong>published_question_points</strong>, <strong>rating_points</strong>, <strong>correct_answers_points</strong>, <strong>false_answers_points</strong>. Danach können Sie die Daten als Excel herunterladen.</p>

          <label for="htmlInputRanking" class="label">HTML-Eingabe</label>
          <textarea id="htmlInputRanking" placeholder="Hier HTML-Code einfügen..."></textarea>

          <div class="buttons">
            <button id="btnSampleRanking" type="button">Beispiel einfügen</button>
            <button id="btnParseRanking" type="button" class="primary">Extrahieren & Vorschau</button>
            <button id="btnClearRanking" type="button" class="secondary">Leeren</button>
            <button id="btnDownloadRanking" type="button" class="success">Als Excel herunterladen</button>
          </div>

          <div id="statusRanking" class="status" role="status" aria-live="polite"></div>

          <div class="table-wrapper">
            <table id="previewTableRanking">
              <thead>
                <tr>
                  <th>student_name</th>
                  <th>published_question_points</th>
                  <th>rating_points</th>
                  <th>correct_answers_points</th>
                  <th>false_answers_points</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <details class="note">
            <summary>Hinweis zur Extraktion</summary>
            <ul>
              <li>Die Extraktion erfolgt analog zur StudentQuiz-Tabelle.</li>
              <li>Punktwerte werden als numerische Werte extrahiert.</li>
            </ul>
          </details>
        </div>
      </details>

      <!-- Bereich 4: Bewertungen -->
      <details class="wizard-section" open>
        <summary><h2>4. Bewertungen</h2></summary>
        <div class="wizard-content">
          <p class="hint">In diesem Bereich werden basierend auf den extrahierten Daten aus den Bereichen 2 und 3 automatisch Bewertungen für die Studierenden berechnet. Sie können die automatisch generierten Bewertungen manuell überschreiben und Begründungen hinzufügen. Am Ende können Sie die finalen Bewertungen als Excel-Datei exportieren.</p>
          
          <div class="buttons">
            <button id="btnGenerateGrades" type="button" class="primary" disabled>Bewertungen generieren</button>
            <button id="btnDownloadGrades" type="button" class="success" disabled>Bewertungen als Excel herunterladen</button>
          </div>

          <div id="statusGrades" class="status" role="status" aria-live="polite"></div>

          <div class="table-wrapper">
            <table id="gradesTable">
              <thead>
                <tr>
                  <th>Student</th>
                  <th>Anzahl Fragen</th>
                  <th>Ø Schwierigkeit</th>
                  <th>Ø Bewertung</th>
                  <th>Σ Kommentare</th>
                  <th>Punkte veröffentlichte Fragen</th>
                  <th>Punkte Sterne</th>
                  <th>Punkte richtige Antworten</th>
                  <th>Punkte falsche Antworten</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <details class="note">
            <summary>Hinweis zur Bewertung</summary>
            <ul>
              <li>Die automatische Bewertung wird basierend auf den extrahierten Daten berechnet.</li>
              <li>Sie können die automatische Bewertung manuell überschreiben.</li>
              <li>Begründungen helfen bei der Nachvollziehbarkeit manueller Anpassungen.</li>
            </ul>
          </details>
        </div>
      </details>

    </section>

    <section id="page-assign" class="page" aria-labelledby="tabAssign">
      <p class="hint">Studierenden-Themenzuteilung: Laden Sie eine Excel-Datei mit den Spalten <strong>Kuerzel</strong> und <strong>Klasse</strong> hoch, geben Sie die Testnummer und die Blöcke an und erzeugen Sie die Zuteilung.</p>

      <label for="studentsFile" class="label">Excel mit Studierenden (Kuerzel, Klasse)</label>
      <input id="studentsFile" type="file" accept=".xlsx,.xls,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel" />

      <label for="testNumber" class="label">Testnummer (1–12)</label>
      <input id="testNumber" type="number" min="1" max="12" placeholder="z. B. 3" />

      <label for="blocksInput" class="label">Blöcke (Semikolon-getrennt, Format: Semesterwoche_Folienbereich)</label>
      <input id="blocksInput" type="text" placeholder="z. B. 1_8-12; 1_13-17; 2_2-6" />

      <div class="buttons">
        <button id="btnTemplate" type="button" class="secondary">Template herunterladen</button>
        <button id="btnAssign" type="button" class="primary">Zuteilen & Vorschau</button>
        <button id="btnDownloadAssign" type="button" class="success">Als Excel herunterladen</button>
      </div>

      <div id="assignStatus" class="status" role="status" aria-live="polite"></div>

      <div id="assignSummary"></div>

      <div class="table-wrapper">
        <table id="assignPreviewTable">
          <thead>
            <tr>
              <th>Kürzel</th>
              <th>Klasse</th>
              <th>Frage erstellen in Block</th>
              <th>Fragen beantworten in Blöcken</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <details class="note">
        <summary>Hinweis zum Blöcke-Format</summary>
        <ul>
          <li>Format pro Block: <code>Semesterwoche_Folienbereich</code> (z. B. <code>1_8-12</code>).</li>
          <li>Mehrere Blöcke semikolongetrennt (z. B. <code>1_8-12; 1_13-17; 2_2-6</code>).</li>
          <li>Im Output werden Wochen zweistellig formatiert (z. B. <code>SW01F8-12</code>).</li>
        </ul>
      </details>
    </section>
  </div>
</body>
</html>
